<tool id="raxml8" name="RAxML8" version="1.0" force_history_refresh='True'>
    <description> Maximum Likelihood Phylogenetic Analysis </description>
    <requirements>
        <requirement type="package">raxml 8.1.1</requirement>
    </requirements>
    <command interpreter="perl">

          #if $datatype.PROT == "PROT":
		raxml2.pl $GAMMA "PROT" ${datatype.protmodel} "NULL" $data_file $part_file $constraint 
		$Boot $seed Long $Out > $raxml_log
		2>&amp;1
          #elif $datatype.PROT == "DNA":
		raxml2.pl $GAMMA "DNA" "NULL" "NULL" $data_file $part_file $constraint 
		$Boot $seed Long $Out > $raxml_log
		2>&amp;1
          #elif $datatype.PROT == "MORPH":
		raxml2.pl $GAMMA "DNA" "NULL" ${datatype.morphmodel} $data_file $part_file $constraint 
		$Boot $seed Long $Out > $raxml_log
		2>&amp;1
          #else:
          #end if#

    </command>
    <inputs>
        <param format="txt" name="data_file" type="data" label="Raxml Phylip File" help=""/>


    <conditional name="datatype">
    <param name="PROT" type="select" label="Data Type (ignored if specified in partition file)">
      <option value="DNA">DNA</option>
      <option value="PROT">Protein</option>
      <option value="MORPH">Morphology</option>
    </param>
    <when value="PROT">
    <param name="protmodel" type="select" label="Protein Model">
      <option value="WAG">WAG</option>
      <option value="AUTO">AUTO</option>
      <option value="GTR">GTR</option>
      <option value="DAYHOFF">DAYHOFF</option>
      <option value="DCMUT">DCMUT</option>
      <option value="JTT">JTT</option>
      <option value="MTREV">MTREV</option>
      <option value="RTREV">RTREV</option>
      <option value="CPREV">CPREV</option>
      <option value="VT">VT</option>
      <option value="BLOSUM62">BLOSUM62</option>
      <option value="MTMAM">MTMAM</option>
      <option value="LG">LG</option>
      <option value="MTART">MTART</option>
      <option value="MTZOA">MTZOA</option>
      <option value="PMB">PMB</option>
      <option value="HIVB">HIVB</option>
      <option value="HIVW">HIVW</option>
      <option value="JTTDCMUT">JTTDCMUT</option>
      <option value="FLU">FLU</option>
    </param>
    </when>
    <when value="MORPH">
    <param name="morphmodel" type="select" optional="true" label="Multi-state morphological char model" help="Ignored unless specifying MULTI in model partition">
      <option value="MK">MK</option>
      <option value="ORDERED">ORDERED</option>
      <option value="GTR">GTR</option>
    </param>
    </when>


    </conditional>

        <param name="GAMMA" type="select" label="Rate Heterogeneity Model">
         <option value="GAMMA">GAMMA</option>
         <option value="CAT">CAT</option>
        </param>
	<param name="Out" type="text" label="Outgroup (optional)" help="The name of one or more (comma-separated) outgroup(s) can be specified"/>
	<param name="Boot" type="integer" value="0" label="Specify Number of bootstrap replicates" help='For larger data sets use raxml_boot which uses MPI'/>
	<param name="seed" type="integer" value="1234567" label="Random Number Seed"/>
        <param format="txt" name="part_file" type="data" optional="true" label="Partition file" help="You may provide an alignment partition file."/>
	<param format="newick" name="constraint" type="data" label="BINARY Constraint Tree" optional="true" help="This option allows you to specify an incomplete or comprehensive multifurcating constraint tree in NEWICK format."/>
	<param name="Run" type="text" label="Run Name" help="For Galaxy History"/>
    </inputs>
    <outputs>
	<data format="txt" name="raxml_log" label="$Run: ${tool.name} Screen Output on ${on_string}" />
        <data format="txt" name="boot_tree" label="$Run: ${tool.name} Bootstrap Trees on ${on_string}" from_work_dir="RAxML_bootstrap.galaxy" />
        <data format="txt" name="bipartitions" label="$Run: ${tool.name} Bootstrap bipartitions on ${on_string}" from_work_dir="RAxML_bipartitionsBranchLabels.galaxy" />
        <data format="txt" name="branchlabelboots" label="$Run: ${tool.name} Branchlabel bootstrap bipartitions on ${on_string}" from_work_dir="RAxML_bipartitions.galaxy" />
        <data format="txt" name="raxml_info" label="$Run: ${tool.name} Log File on ${on_string}" from_work_dir="RAxML_info.galaxy" />
        <data format="txt" name="best_trees" label="$Run: ${tool.name} ML Tree ${on_string}" from_work_dir="RAxML_bestTree.galaxy" />
    </outputs>
    <tests>
    </tests>
    <help>
**What it does**

RAxML estimates phylogenetic trees using Maximum Likelihood. This tool is for RAxML version 8.

------

**Inputs**

Input file is a RAxML compatible text file. This can be generated by Osiris tools from an aligned fasta file with fasta2phylipE or from a PHYTAB format file with phylocatenator.

------

**Outputs**

RAxML writes the resulting tree file in newick text format, which can be viewed in Osiris with TreeVector (of the mothur package). In addition, if bootstrapping was selected, the individual bootstrap trees and the ML tree with support are written as separate newick files.

-------    

**Versioning**

Version 1.x.x is written in raxml.xml and raxml.pl

Version 2.0 is written in raxml2.xml

Compatible with RAxML v 8.1.1

Adds AUTO model to automagically determine best-fit protein model

Modification of tool interface to make more efficent

Possibility to conduct ML analysis without bootstrap

-------    

**Additional Information**

raxml Home Page.
http://www.exelixis-lab.org/software.html
   
-------    

**Citations**   

This tool is part of the Osiris Phylogenetics Tool Package for Galaxy. If you make extensive use of this tool in a publication, please consider citing the following.

Current Osiris Citation is here

http://osiris-phylogenetics.blogspot.com/2012/10/citation.html

Additional Citations for this tool

Stamatakis, A. (2006). RAxML-VI-HPC: maximum likelihood-based phylogenetic analyses with thousands of taxa and mixed models. Bioinformatics.
http://bioinformatics.oxfordjournals.org/content/22/21/2688.short

    </help>
</tool>
